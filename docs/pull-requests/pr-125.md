---
type: pull_request
state: closed (merged)
branch: feature/103-worktree-workflow-enhancements → dev
created: 2026-02-20T15:47:44Z
updated: 2026-02-20T16:41:55Z
author: gerchowl
author_url: https://github.com/gerchowl
url: https://github.com/vig-os/devcontainer/pull/125
comments: 0
labels: none
assignees: gerchowl
milestone: none
projects: none
relationship: none
merged: 2026-02-20T16:41:53Z
synced: 2026-02-20T16:48:54.943Z
---

# [PR 125](https://github.com/vig-os/devcontainer/pull/125) feat: enhance worktree workflow — config SSoT, branch resolution fix, subagent delegation (#103)

## Description

Enhance the worktree-based autonomous development workflow with centralized configuration, bug fixes, and skill improvements. This PR addresses all three goals of issue #103:

1. **Config as SSoT** — Agent model tier assignments extracted to `.cursor/agent-models.toml`
2. **Fix branch resolution** — `gh issue develop --list` tab-separated output now parsed correctly via `scripts/resolve-branch.sh`
3. **Subagent delegation & reviewer support** — Delegation sections added to 12 skills; worktree reviewer threading documented

## Type of Change

- [x] `feat` -- New feature
- [x] `fix` -- Bug fix
- [x] `docs` -- Documentation only
- [x] `chore` -- Maintenance task (deps, config, etc.)
- [x] `test` -- Adding or updating tests

## Changes Made

### Config as SSoT (`chore: extract agent model config to SSoT`)
- New `.cursor/agent-models.toml` with `lightweight`, `autonomous`, and `standard` tiers plus `[skill-tiers]` mapping
- Synced to workspace template

### Subagent delegation & reviewer support (`feat(skills): add subagent delegation and worktree reviewer support`)
- New `.cursor/rules/subagent-delegation.mdc` rule
- `## Delegation` sections added to 12 skills identifying steps suitable for lightweight subagents
- New `solve-and-pr` skill for full autonomous pipeline

### Branch resolution fix (`fix: extract branch resolution to script and fix tab-separated parsing`)
- `gh issue develop --list` returns `branch<TAB>URL`; old `grep -oE '[^ ]+$'` captured full line
- Extracted parsing to `scripts/resolve-branch.sh` (`head -1 | cut -f1`) — SSoT for both call sites in `justfile.worktree`
- 5 BATS tests in `tests/bats/worktree.bats` exercising the script directly

### Documentation
- TDD rule updated: commit-after-RED is now a separate numbered step
- `code:execute` and `code:tdd` skills linked to `git:commit` skill and commit-messages rule
- SKILL_PIPELINE.md generated from new Jinja2 template
- ASCII diagram alignment fix in skill pipeline docs

## Changelog Entry

### Added
- **Config-driven model tier assignments for agent skills** ([#103](https://github.com/vig-os/devcontainer/issues/103))

### Fixed
- **Worktree branch resolution broken by tab-separated `gh` output** ([#103](https://github.com/vig-os/devcontainer/issues/103))
  - `gh issue develop --list` now returns `branch<TAB>URL`; the previous `grep -oE '[^ ]+$'` captured the entire line
  - Extracted parsing into `scripts/resolve-branch.sh` (`head -1 | cut -f1`) used by both call sites in `justfile.worktree`

## Testing

- [x] Tests pass locally (`just test`) — 231 passed, 1 skipped, 1 pre-existing failure (unrelated `test_manifest_files`)
- [x] BATS tests: `bats tests/bats/worktree.bats` — 5/5 pass
- [x] Manual testing: verified `gh issue develop --list 103` output parsed correctly with new script

### Manual Testing Details

```bash
# Confirmed broken behavior
$ gh issue develop --list 103 | grep -oE '[^ ]+$' | head -1
feature/103-worktree-workflow-enhancements\thttps://...  # full line captured

# Confirmed fix
$ gh issue develop --list 103 | scripts/resolve-branch.sh
feature/103-worktree-workflow-enhancements  # branch only
```

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have commented my code, particularly in hard-to-understand areas
- [x] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [x] I have added tests that prove my fix is effective or that my feature works
- [x] New and existing unit tests pass locally with my changes
- [x] Any dependent changes have been merged and published

## Additional Notes

- Sub-issue #102 (optional reviewer param) was completed and merged into dev separately; this PR includes the merge of dev
- The pre-existing `test_manifest_files` failure is due to `subagent-delegation.mdc` not being in the built container image yet — it will resolve once the sync manifest is updated in a follow-up

Refs: #103



---
---

## Commits

### Commit 1: [c1e59df](https://github.com/vig-os/devcontainer/commit/c1e59dfa76912656101c8b88b8ea3da59a93e744) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 10:02 AM
chore: extract agent model config to SSoT, 38 files modified (.cursor/agent-models.toml, assets/workspace/.cursor/agent-models.toml, assets/workspace/.devcontainer/justfile.worktree, justfile.worktree)

### Commit 2: [b3ea770](https://github.com/vig-os/devcontainer/commit/b3ea770c098bda58510c621e1c921942efe64a06) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 12:56 PM
docs: fix ASCII diagram alignment in skill pipeline, 538 files modified (docs/SKILL_PIPELINE.md, docs/templates/SKILL_PIPELINE.md.j2)

### Commit 3: [eb73c39](https://github.com/vig-os/devcontainer/commit/eb73c397a11f3fc8e7bf0390cbff30d052e4651d) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 01:03 PM
feat(skills): add subagent delegation and worktree reviewer support, 525 files modified

### Commit 4: [5290fb5](https://github.com/vig-os/devcontainer/commit/5290fb520419d1dd56d81c9acb95c2351b996646) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 01:30 PM
docs: link TDD and execute commit steps to git:commit skill and commit-messages rule, 28 files modified

### Commit 5: [9d49b85](https://github.com/vig-os/devcontainer/commit/9d49b8501fa317fab5eff90b4eb79a847cff468c) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 02:35 PM
docs: make commit-after-RED a separate TDD step, 94 files modified (.cursor/rules/tdd.mdc, .cursor/skills/code:tdd/SKILL.md, CLAUDE.md, assets/workspace/.cursor/skills/code:tdd/SKILL.md)

### Commit 6: [3e37e9a](https://github.com/vig-os/devcontainer/commit/3e37e9a25c6ba68e7e4cf1e4132bbfa5606945b0) by [commit-action-bot[bot]](https://github.com/apps/commit-action-bot) on February 20, 2026 at 03:25 PM
chore: sync issues and PRs, 1415 files modified

### Commit 7: [342358c](https://github.com/vig-os/devcontainer/commit/342358c36873b2db610fc077fcfe04d818e62559) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 03:29 PM
test: add BATS test for tab-separated branch resolution parsing, 48 files modified (tests/bats/worktree.bats)

### Commit 8: [0850519](https://github.com/vig-os/devcontainer/commit/08505195da577c549d4c23169a7745545088d8f5) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 03:32 PM
test: add BATS tests for resolve-branch script, 52 files modified (tests/bats/worktree.bats)

### Commit 9: [7568229](https://github.com/vig-os/devcontainer/commit/75682298c039b1efbb79b47af15a877acc9b47e7) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 03:33 PM
fix: extract branch resolution to script and fix tab-separated parsing, 9 files modified (justfile.worktree, scripts/resolve-branch.sh)

### Commit 10: [655ce2d](https://github.com/vig-os/devcontainer/commit/655ce2dd655b39e86a11cce1aec1369937c61c29) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 03:36 PM
docs: update CHANGELOG for branch resolution fix, 3 files modified (CHANGELOG.md)

### Commit 11: [b0bba38](https://github.com/vig-os/devcontainer/commit/b0bba38dfe56eb97324b1c21ee88e170b522a301) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 03:41 PM
Merge remote-tracking branch 'origin/dev' into feature/103-worktree-workflow-enhancements, 15023 files modified

### Commit 12: [9e42947](https://github.com/vig-os/devcontainer/commit/9e42947a57497446fd05204333fca4956635202f) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 03:44 PM
Merge branch 'feature/103-worktree-workflow-enhancements' of github.com:vig-os/devcontainer into feature/103-worktree-workflow-enhancements, 904 files modified

### Commit 13: [dda8ed9](https://github.com/vig-os/devcontainer/commit/dda8ed9f782a6813bbcba8170c4a4093d3964e34) by [gerchowl](https://github.com/gerchowl) on February 20, 2026 at 04:02 PM
Merge branch 'dev' into feature/103-worktree-workflow-enhancements, 209 files modified
