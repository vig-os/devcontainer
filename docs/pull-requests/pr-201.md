---
type: pull_request
state: open
branch: bugfix/197-install-sh-idempotent → dev
created: 2026-02-25T10:35:44Z
updated: 2026-02-25T10:35:45Z
author: c-vigo
author_url: https://github.com/c-vigo
url: https://github.com/vig-os/devcontainer/pull/201
comments: 0
labels: none
assignees: c-vigo
milestone: none
projects: none
relationship: none
synced: 2026-02-26T04:22:31.492Z
---

# [PR 201](https://github.com/vig-os/devcontainer/pull/201) fix(workspace): make install.sh idempotent for template_project rename (#197)

## Description

Fix `install.sh` (via `init-workspace.sh`) to be idempotent when run with `--force` on an already-initialized workspace. On second run, rsync re-copies `src/template_project/` and the `mv` command moves it inside the existing `src/${SHORT_NAME}/` directory, creating a nested `src/${SHORT_NAME}/template_project/`. The fix guards the rename: if the destination already exists, the redundant copy is removed instead.

## Type of Change

- [ ] `feat` -- New feature
- [x] `fix` -- Bug fix
- [ ] `docs` -- Documentation only
- [ ] `chore` -- Maintenance task (deps, config, etc.)
- [ ] `refactor` -- Code restructuring (no behavior change)
- [ ] `test` -- Adding or updating tests
- [ ] `ci` -- CI/CD pipeline changes
- [ ] `build` -- Build system or dependency changes
- [ ] `revert` -- Reverts a previous commit
- [ ] `style` -- Code style (formatting, whitespace)

### Modifiers

- [ ] Breaking change (`!`) -- This change breaks backward compatibility

## Changes Made

- `assets/init-workspace.sh` — Guard the `mv src/template_project src/${SHORT_NAME}` block: if the destination directory already exists (and SHORT_NAME is not "template_project"), remove the redundant rsync-copied `src/template_project` instead of moving it inside the existing directory.
- `tests/bats/init-workspace.bats` — BATS test verifying the idempotent guard clause exists in the script (checks for the `rm -rf` branch alongside `src/${SHORT_NAME}`).
- `CHANGELOG.md` — Entry under `## Unreleased` / `### Fixed`.

## Changelog Entry

### Fixed

- **install.sh is not idempotent — creates nested src/template_project on second run** ([#197](https://github.com/vig-os/devcontainer/issues/197))
  - Guard template_project rename: if `src/${SHORT_NAME}` already exists, remove the redundant copy instead of moving it inside

## Testing

- [x] Tests pass locally (`just test`)
- [ ] Manual testing performed (describe below)

### Manual Testing Details

N/A — functional testing of init-workspace.sh requires a container environment (covered by integration tests in CI).

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have commented my code, particularly in hard-to-understand areas
- [ ] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [x] I have added tests that prove my fix is effective or that my feature works
- [x] New and existing unit tests pass locally with my changes
- [ ] Any dependent changes have been merged and published

## Additional Notes

N/A

Refs: #197

