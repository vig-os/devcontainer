---
type: pull_request
state: closed (merged)
branch: bugfix/204-postattach-error-crun-getcwd â†’ feature/70-remote-devc-orchestration
created: 2026-02-25T14:16:01Z
updated: 2026-02-25T14:16:57Z
author: c-vigo
author_url: https://github.com/c-vigo
url: https://github.com/vig-os/devcontainer/pull/205
comments: 0
labels: none
assignees: none
milestone: none
projects: none
relationship: none
merged: 2026-02-25T14:16:55Z
synced: 2026-02-26T04:22:30.667Z
---

# [PR 205](https://github.com/vig-os/devcontainer/pull/205) fix(image): run lifecycle commands inside the container via bash

## Description

Ensure devcontainer lifecycle hooks execute reliably in downstream workspaces by invoking hook scripts through `/bin/bash` in `devcontainer.json`. Add integration coverage for all three lifecycle commands (`postCreate`, `postStart`, `postAttach`) so command format regressions are caught by tests.

## Type of Change

- [ ] `feat` -- New feature
- [x] `fix` -- Bug fix
- [x] `docs` -- Documentation only
- [ ] `chore` -- Maintenance task (deps, config, etc.)
- [ ] `refactor` -- Code restructuring (no behavior change)
- [x] `test` -- Adding or updating tests
- [ ] `ci` -- CI/CD pipeline changes
- [ ] `build` -- Build system or dependency changes
- [ ] `revert` -- Reverts a previous commit
- [ ] `style` -- Code style (formatting, whitespace)

### Modifiers

- [ ] Breaking change (`!`) -- This change breaks backward compatibility

## Changes Made

- `assets/workspace/.devcontainer/devcontainer.json`
  - Update `postCreateCommand`, `postStartCommand`, and `postAttachCommand` to run scripts via `/bin/bash`.
  - Keep existing script paths unchanged while making command execution more robust.
- `tests/test_integration.py`
  - Update expectations for `postAttachCommand` and `postCreateCommand` to include `/bin/bash`.
  - Add `test_devcontainer_json_post_start_command` to validate `postStartCommand` uses the same bash-wrapped format.
- `CHANGELOG.md`
  - Add an Unreleased `### Fixed` entry for issue `#204` describing the lifecycle-command fix and user-visible error resolved.

## Changelog Entry

### Fixed
- **Devcontainer lifecycle commands fail in mock-up folders with crun getcwd error** ([#204](https://github.com/vig-os/devcontainer/issues/204))
  - Run post-create, post-start, and post-attach commands via `/bin/bash` in `devcontainer.json` for stable command resolution on attach
  - Prevent attach-time failure where OCI runtime reports `getcwd: No such file or directory`
  - Update tests in `test-integration.py`

## Testing

- [ ] Tests pass locally (`just test`)
- [ ] Manual testing performed (describe below)

### Manual Testing Details

Added/updated integration assertions in `tests/test_integration.py`:
- `postAttachCommand` expected value includes `/bin/bash`
- `postCreateCommand` expected value includes `/bin/bash`
- new `postStartCommand` assertion

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [ ] I have commented my code, particularly in hard-to-understand areas
- [ ] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [ ] I have added tests that prove my fix is effective or that my feature works
- [ ] New and existing unit tests pass locally with my changes
- [x] Any dependent changes have been merged and published

## Additional Notes

Closes #204

Refs: #204



---
---

## Commits

### Commit 1: [137f226](https://github.com/vig-os/devcontainer/commit/137f226817e401a3797a3a1489e6b9a5ceca1366) by [c-vigo](https://github.com/c-vigo) on February 25, 2026 at 12:37 PM
fix(image): run lifecycle commands inside the container via bash, 6 files modified (assets/workspace/.devcontainer/devcontainer.json)

### Commit 2: [5d61d9e](https://github.com/vig-os/devcontainer/commit/5d61d9ea0788298bdb5bbc1255ece1f055592902) by [c-vigo](https://github.com/c-vigo) on February 25, 2026 at 02:12 PM
test: cover bash-wrapped devcontainer lifecycle commands, 25 files modified (tests/test_integration.py)

### Commit 3: [db7cfdf](https://github.com/vig-os/devcontainer/commit/db7cfdf460f986d68017d0204f34953055c0d295) by [c-vigo](https://github.com/c-vigo) on February 25, 2026 at 02:13 PM
docs: update CHANGELOG, 4 files modified (CHANGELOG.md)
