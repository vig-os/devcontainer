---
type: pull_request
state: closed (merged)
branch: bugfix/111-fix-devcontainer-npm-permissions → dev
created: 2026-02-20T11:06:38Z
updated: 2026-02-20T13:19:10Z
author: c-vigo
author_url: https://github.com/c-vigo
url: https://github.com/vig-os/devcontainer/pull/112
comments: 0
labels: none
assignees: c-vigo
milestone: none
projects: none
relationship: none
merged: 2026-02-20T13:19:06Z
synced: 2026-02-20T15:25:50.144Z
---

# [PR 112](https://github.com/vig-os/devcontainer/pull/112) fix(setup): use local npm install for devcontainer CLI

## Description

Fix `just init` failing to install the `devcontainer` CLI on Linux due to npm global install permission error (`EACCES: permission denied` on `/usr/local/lib/node_modules`). The `@devcontainers/cli` package is already declared in `package.json`, so this switches from `npm install -g` to a local `npm install`, matching the existing `bats` dependency pattern.

## Related Issue(s)

Closes #111

## Type of Change

- [x] Bug fix (non-breaking change which fixes an issue)
- [ ] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [ ] Documentation update
- [ ] Refactoring (no functional changes)
- [ ] CI / Build change
- [x] Test updates

## Changes Made

- `scripts/requirements.yaml`: Changed devcontainer entry to use local `npm install` instead of `npm install -g`, added `node_modules/.bin/devcontainer` fallback to check command, switched version command to `npx devcontainer --version`
- `tests/bats/init.bats`: Added 2 tests asserting the local install pattern and absence of global install
- `CHANGELOG.md`: Added Fixed entry under Unreleased

## Changelog Entry

### Fixed

- **`just init` fails to install devcontainer CLI on Linux** ([#111](https://github.com/vig-os/devcontainer/issues/111))
  - `npm install -g` requires root access to `/usr/local/lib/node_modules`, causing EACCES permission denied
  - Switched to local `npm install` (package already declared in `package.json`), matching the existing `bats` pattern

## Testing

- [x] Tests pass locally (`just test`)
- [x] Manual testing performed (describe below)

### Manual Testing Details

1. `npx bats tests/bats/init.bats --filter "devcontainer"` — both new tests pass
2. `npx bats tests/bats/init.bats` — all 70 tests pass (no regressions)
3. `just init --check` — devcontainer 0.81.1 detected as installed via `node_modules/.bin/devcontainer`

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have commented my code, particularly in hard-to-understand areas
- [x] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [x] I have added tests that prove my fix is effective or that my feature works
- [x] New and existing unit tests pass locally with my changes
- [x] Any dependent changes have been merged and published

## Additional Notes

The CI setup action (`.github/actions/setup-env/action.yml`) still uses `npm install -g` for the devcontainer CLI. This is intentional — GitHub Actions runners have appropriate permissions for global installs. Only the local development path (`just init`) is affected by this fix.

Refs: #111



---
---

## Commits

### Commit 1: [1db7106](https://github.com/vig-os/devcontainer/commit/1db7106c5398d961d838033be100efcf1e3c0631) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:00 AM
test(setup): add tests for devcontainer local npm install pattern, 12 files modified (tests/bats/init.bats)

### Commit 2: [af7f909](https://github.com/vig-os/devcontainer/commit/af7f909cc3c04545dce056d9e1b7f54f4c17920d) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:02 AM
fix(setup): use local npm install for devcontainer CLI, 8 files modified (scripts/requirements.yaml)

### Commit 3: [532794e](https://github.com/vig-os/devcontainer/commit/532794e80ed5baf89d5def46cfa844f025142a03) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:04 AM
docs(setup): add changelog entry for devcontainer npm permissions fix, 3 files modified (CHANGELOG.md)

### Commit 4: [301e45a](https://github.com/vig-os/devcontainer/commit/301e45abceb3ec1870dcbfd0ec27ca32562252f8) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:52 AM
test(setup): add tests for conftest.py devcontainer local path check, 10 files modified (tests/bats/init.bats)

### Commit 5: [0564a3e](https://github.com/vig-os/devcontainer/commit/0564a3ec125b77d72474ad9f59b670eff5c0bab3) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 11:53 AM
fix(setup): detect devcontainer CLI in node_modules/.bin from pytest, 18 files modified (tests/conftest.py)

### Commit 6: [0b8c943](https://github.com/vig-os/devcontainer/commit/0b8c94392914f481a4fda04108be089c70814936) by [c-vigo](https://github.com/c-vigo) on February 20, 2026 at 12:31 PM
fix: resolve devcontainer CLI from node_modules/.bin, 26 files modified (CHANGELOG.md, tests/conftest.py)
