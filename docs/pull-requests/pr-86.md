---
type: pull_request
state: closed (merged)
branch: chore/docs-setup-formatting-fixes → dev
created: 2026-02-18T23:28:18Z
updated: 2026-02-19T17:52:11Z
author: gerchowl
author_url: https://github.com/gerchowl
url: https://github.com/vig-os/devcontainer/pull/86
comments: 1
labels: none
assignees: none
milestone: none
projects: none
relationship: none
merged: 2026-02-19T17:51:54Z
synced: 2026-02-19T17:52:16.933Z
---

# [PR 86](https://github.com/vig-os/devcontainer/pull/86) chore: docs, setup lifecycle, and justfile formatting fixes

## Summary

- **fix(setup):** rewrite host-specific paths in `.gitconfig` at export time and refactor devcontainer lifecycle hooks — one-time setup moved from `postAttachCommand` to `postCreateCommand`, new `verify-auth.sh` for lightweight attach-time checks ([#60](https://github.com/vig-os/devcontainer/issues/60))
- **docs:** fix broken `curl | bash -s` install examples (wrong `--` separator placement) and clarify bare semver image tags vs v-prefixed git tags ([#57](https://github.com/vig-os/devcontainer/issues/57))
- **style:** apply canonical `just --fmt` formatting to `justfile.base` and `justfile.project` ([#45](https://github.com/vig-os/devcontainer/issues/45))

## Related Issues

Refs: #60, #57, #45

## Type of Change

- [x] Bug fix (non-breaking change which fixes an issue)
- [ ] New feature (non-breaking change which adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
- [x] Documentation update
- [x] Refactoring (no functional changes)
- [ ] CI / Build change
- [x] Test updates

## Changes Made

### `fix(setup)` — host paths and lifecycle refactor (#60)
- **`copy-host-user-conf.sh`** — generates a container-ready `.gitconfig` rewriting host paths (`user.signingkey`, `gpg.ssh.allowedsignersfile`) to `/root/...` equivalents; strips host-only entries (`credential.*`, `includeIf.*`, `core.excludesfile`)
- **`post-create.sh`** — now runs all one-time setup (git config, SSH keys, gh auth, pre-commit, `uv sync`) previously in `postAttachCommand`
- **`post-attach.sh`** — simplified to auth verification only
- **`verify-auth.sh`** — new script: read-only SSH agent and `gh auth` checks, socket scanning fallback
- **`setup-git-conf.sh`** — heavily slimmed (removed SSH agent scanning logic, now just file placement)
- **`CHANGELOG.md`** — added entry under Fixed
- **`tests/test_image.py`, `tests/test_integration.py`** — added `verify-auth.sh` to expected file lists

### `docs` — install examples and image tags (#57)
- **`README.md`, `docs/templates/README.md.j2`** — moved `--` separator to correct position after `bash -s`; replaced `1.0.0` with `0.2.1`; added semver image tag note
- **`install.sh`** — fixed version references in help text

### `style` — justfile formatting (#45)
- **`justfile.base`** — canonical `just --fmt` spacing for interpolations (`{{args}}` → `{{ args }}`)
- **`justfile.project`** — same formatting, removed extra blank lines

## Testing

- [x] Tests pass locally
- [x] Pre-commit hooks pass

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have updated the documentation accordingly
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section
- [x] My changes generate no new warnings or errors
- [x] New and existing unit tests pass locally with my changes


---
---

## Review Threads (1)

### Review by [@c-vigo](https://github.com/c-vigo)

_Posted on February 19, 2026 at 04:41 PM_

_File: [`assets/workspace/.devcontainer/scripts/post-create.sh`](https://github.com/vig-os/devcontainer/pull/86#discussion_r2828914181)_

```diff
@@ -1,18 +1,38 @@
 #!/bin/bash
 
-# Post-create script - runs when container is created for the first time
-# This script is called from postCreateCommand in devcontainer.json
+# Post-create script - runs once when container is created for the first time.
+# This script is called from postCreateCommand in devcontainer.json.
+#
+# All one-time setup belongs here:
+#   - Git repo init, config, hooks
+#   - SSH key + allowed-signers placement
+#   - GitHub CLI config + authentication
+#   - Pre-commit hook installation
+#   - Python dependency sync
 
 set -euo pipefail
 
 echo "Running post-create setup..."
 
+SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
+PROJECT_ROOT="/workspace/{{SHORT_NAME}}"
+
+if [ ! -d "$PROJECT_ROOT" ]; then
+    echo "Error: Project directory $PROJECT_ROOT does not exist"
+    exit 1
+fi
+
 # Set venv prompt
 sed -i 's/template-project/{{SHORT_NAME}}/g' /root/assets/workspace/.venv/bin/activate
 
+# One-time setup: git repo, config, hooks, gh auth
+"$SCRIPT_DIR/init-git.sh"
+"$SCRIPT_DIR/setup-git-conf.sh"
+"$SCRIPT_DIR/init-precommit.sh"
+
 # Sync Python dependencies (fast if nothing changed from pre-built venv)
 # Use --no-install-project since new projects may not have source code yet
-if [[ -f "pyproject.toml" ]]; then
+if [[ -f "$PROJECT_ROOT/pyproject.toml" ]]; then
     echo "Syncing Python dependencies..."
     uv sync --all-extras --no-install-project
 fi
```

There's still an argument to be made that `uv sync` should run every time you attach to a container, since dependencies may have been updated e.g. by other contributors. It is so fast that I see no reason not to do it.


---
---

## Commits

### Commit 1: [71e1d8a](https://github.com/vig-os/devcontainer/commit/71e1d8aca270126464ebe8700a65fcd6753a12ca) by [gerchowl](https://github.com/gerchowl) on February 17, 2026 at 06:38 PM
docs: fix broken curl install examples and clarify image tag convention, 46 files modified (README.md, docs/templates/README.md.j2, install.sh)

### Commit 2: [80b7396](https://github.com/vig-os/devcontainer/commit/80b7396adf4af47274d2ddc29c13f3753cc4e138) by [gerchowl](https://github.com/gerchowl) on February 17, 2026 at 07:34 PM
fix(setup): rewrite host paths in .gitconfig and refactor lifecycle hooks, 350 files modified

### Commit 3: [78208f9](https://github.com/vig-os/devcontainer/commit/78208f9528c53acd943c2a84ecb044996913a81c) by [gerchowl](https://github.com/gerchowl) on February 17, 2026 at 07:40 PM
style: apply canonical just --fmt formatting to justfiles, 28 files modified (assets/workspace/.devcontainer/justfile.base, assets/workspace/justfile.project)

### Commit 4: [db127bf](https://github.com/vig-os/devcontainer/commit/db127bf25cf566fb274ef39b57f68444d858b2b6) by [gerchowl](https://github.com/gerchowl) on February 18, 2026 at 11:24 PM
chore: Merge branch 'dev' of github.com:vig-os/devcontainer into dev, 10660 files modified

### Commit 5: [de184c7](https://github.com/vig-os/devcontainer/commit/de184c7bca903e11261a3226a77238285220c64a) by [c-vigo](https://github.com/c-vigo) on February 19, 2026 at 04:35 PM
chore: merge branch 'dev' into chore/docs-setup-formatting-fixes, 6216 files modified

### Commit 6: [74b20d0](https://github.com/vig-os/devcontainer/commit/74b20d0deae82b7e559afcd113b20f6bbfe18a4d) by [c-vigo](https://github.com/c-vigo) on February 19, 2026 at 05:03 PM
Merge branch 'dev' into chore/docs-setup-formatting-fixes

### Commit 7: [b504a0b](https://github.com/vig-os/devcontainer/commit/b504a0bcb11739ca99767e9d9ebdbd30ca868c44) by [c-vigo](https://github.com/c-vigo) on February 19, 2026 at 05:30 PM
chore: add post-start lifecycle script and delegate dependency sync to just, 62 files modified
