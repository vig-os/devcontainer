---
type: pull_request
state: closed (merged)
branch: feature/158-worktree-clean-filter-mode → dev
created: 2026-02-23T08:06:33Z
updated: 2026-02-24T12:47:15Z
author: gerchowl
author_url: https://github.com/gerchowl
url: https://github.com/vig-os/devcontainer/pull/160
comments: 0
labels: none
assignees: gerchowl
milestone: none
projects: none
relationship: none
merged: 2026-02-24T12:47:13Z
synced: 2026-02-25T04:26:20.130Z
---

# [PR 160](https://github.com/vig-os/devcontainer/pull/160) feat(worktree): add filter mode for worktree-clean (#158)

## Description

Adds a `mode` parameter to `worktree-clean` so the default cleans only stopped worktrees (no running tmux session), while `just worktree-clean all` retains the previous behavior (clean all worktrees). Summary output shows what was cleaned vs skipped.

## Type of Change

<!-- Mark the relevant option(s) with an 'x' -->

- [x] `feat` -- New feature
- [ ] `fix` -- Bug fix
- [ ] `docs` -- Documentation only
- [ ] `chore` -- Maintenance task (deps, config, etc.)
- [ ] `refactor` -- Code restructuring (no behavior change)
- [ ] `test` -- Adding or updating tests
- [ ] `ci` -- CI/CD pipeline changes
- [ ] `build` -- Build system or dependency changes
- [ ] `revert` -- Reverts a previous commit
- [ ] `style` -- Code style (formatting, whitespace)

### Modifiers

- [x] Breaking change (`!`) -- This change breaks backward compatibility

## Changes Made

- **justfile.worktree**: Add `mode=""` parameter to `worktree-clean`; stopped-only logic skips dirs with running tmux sessions; `all` mode retains previous behavior with warning; summary output (cleaned vs skipped)
- **assets/workspace/.devcontainer/justfile.worktree**: Synced via manifest
- **tests/bats/worktree.bats**: BATS tests for stopped-only, all mode, invalid mode, wt-clean alias
- **CHANGELOG.md**: Entry under Changed

## Changelog Entry

### Changed

- **worktree-clean: add filter mode for stopped-only vs all** ([#158](https://github.com/vig-os/devcontainer/issues/158))
  - Default `just worktree-clean` (no args) now cleans only stopped worktrees, skips running tmux sessions
  - `just worktree-clean all` retains previous behavior (clean all worktrees) with warning
  - Summary output shows cleaned vs skipped worktrees
  - `just wt-clean` alias unchanged

## Testing

<!-- Describe the tests you ran and how to verify your changes -->
- [x] Tests pass locally (`just test`)
- [x] Manual testing performed (describe below)

### Manual Testing Details

- `just worktree-clean` (no args): cleaned only stopped worktrees, skipped running session
- `just worktree-clean all`: cleaned all worktrees including running sessions
- `just wt-clean` and `just wt-clean all`: alias works
- `just worktree-clean invalid`: exits with error
- BATS: `just test-bats` — all 238 tests pass including 4 new worktree-clean tests

## Checklist

<!-- Mark completed items with an 'x' -->
- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [ ] I have commented my code, particularly in hard-to-understand areas
- [ ] I have updated the documentation accordingly (edit `docs/templates/`, then run `just docs`)
- [x] I have updated `CHANGELOG.md` in the `[Unreleased]` section (and pasted the entry above)
- [x] My changes generate no new warnings or errors
- [x] I have added tests that prove my fix is effective or that my feature works
- [x] New and existing unit tests pass locally with my changes
- [x] Any dependent changes have been merged and published

## Additional Notes

Design and implementation plan posted on issue #158.

Refs: #158



---
---

## Commits

### Commit 1: [8a2a169](https://github.com/vig-os/devcontainer/commit/8a2a169f64076787b1875de8e8e9c62d33976a16) by [gerchowl](https://github.com/gerchowl) on February 23, 2026 at 08:01 AM
test(worktree): add BATS test for worktree-clean stopped-only mode, 34 files modified (tests/bats/worktree.bats)

### Commit 2: [0034303](https://github.com/vig-os/devcontainer/commit/00343032be2a57611f661899598d3986cca1068d) by [gerchowl](https://github.com/gerchowl) on February 23, 2026 at 08:06 AM
feat(worktree): add mode filter to worktree-clean (stopped-only vs all), 144 files modified (CHANGELOG.md, assets/workspace/.devcontainer/justfile.worktree, justfile.worktree, tests/bats/worktree.bats)

### Commit 3: [8093010](https://github.com/vig-os/devcontainer/commit/8093010d2299fb5da534815629b5d9dde8e6227d) by [gerchowl](https://github.com/gerchowl) on February 23, 2026 at 10:51 PM
Merge branch 'dev' into feature/158-worktree-clean-filter-mode, 781 files modified (CHANGELOG.md, scripts/manifest.toml, scripts/sync_manifest.py, scripts/transforms.py, scripts/utils.py, tests/test_transforms.py, tests/test_utils.py)
