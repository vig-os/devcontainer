---
type: pull_request
state: closed (merged)
branch: bugfix/183-worktree-start-error-messages â†’ dev
created: 2026-02-24T15:53:40Z
updated: 2026-02-24T16:41:01Z
author: gerchowl
author_url: https://github.com/gerchowl
url: https://github.com/vig-os/devcontainer/pull/184
comments: 0
labels: none
assignees: none
milestone: none
projects: none
relationship: none
merged: 2026-02-24T16:40:59Z
synced: 2026-02-25T04:26:10.003Z
---

# [PR 184](https://github.com/vig-os/devcontainer/pull/184) fix(worktree): surface derive-branch-summary errors and retry with standard model

## Description

Fixes #183: When `derive-branch-summary.sh` fails (e.g. `agent --print` times out), the error message was silently swallowed by `worktree-start`. This PR surfaces errors and adds a retry with the standard model.

## Type of Change

- [x] `fix` -- Bug fix

## Changes Made

- **scripts/derive-branch-summary.sh**: Add optional `MODEL_TIER` parameter (3rd arg) and `BRANCH_SUMMARY_MODEL` env var; default remains `lightweight`
- **justfile.worktree**: Remove stderr suppression; try lightweight first, retry with standard model on failure; print manual workaround hint with actual issue/type when both fail
- **tests/bats/worktree.bats**: Add BATS test for `MODEL_TIER` parameter
- **assets/workspace/.devcontainer/justfile.worktree**: Synced via `just sync-workspace`

## Changelog Entry

```
### Fixed

- **worktree-start swallows derive-branch-summary error messages** ([#183](https://github.com/vig-os/devcontainer/issues/183))
  - Remove stderr suppression so error messages from derive-branch-summary.sh are visible
  - Retry with standard model when lightweight model fails; print manual workaround hint if both fail
  - Add optional MODEL_TIER parameter to derive-branch-summary.sh; BATS test for retry path
```

## Testing

- [x] BATS test added for MODEL_TIER param
- [x] Manual: `env BRANCH_SUMMARY_CMD="false" ./scripts/derive-branch-summary.sh "Test"` shows [ERROR] and hint
- [x] Manual: `env BRANCH_SUMMARY_CMD="echo retry-summary" ./scripts/derive-branch-summary.sh "Test" "/dev/null" "standard"` returns retry-summary

## Checklist

- [x] My code follows the project's style guidelines
- [x] I have performed a self-review of my code
- [x] I have updated CHANGELOG.md in the [Unreleased] section
- [x] I have added tests that prove my fix is effective

Refs: #183

Made with [Cursor](https://cursor.com)


---
---

## Commits

### Commit 1: [ab832d6](https://github.com/vig-os/devcontainer/commit/ab832d6174b4e6965eb8565e178e005086339f24) by [gerchowl](https://github.com/gerchowl) on February 24, 2026 at 03:53 PM
test: add BATS test for derive-branch-summary MODEL_TIER param, 7 files modified (tests/bats/worktree.bats)

### Commit 2: [3ec1f64](https://github.com/vig-os/devcontainer/commit/3ec1f648850f256b9d7f6b9789524d600ed21b2a) by [gerchowl](https://github.com/gerchowl) on February 24, 2026 at 03:53 PM
fix(worktree): surface derive-branch-summary errors and retry with standard model, 31 files modified (CHANGELOG.md, assets/workspace/.devcontainer/justfile.worktree, justfile.worktree, scripts/derive-branch-summary.sh)
