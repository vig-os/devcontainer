{# CONTRIBUTE.md.j2 - Template for contributor documentation
   Generated from: scripts/requirements.yaml + just --list output
   DO NOT EDIT CONTRIBUTE.md directly - edit this template instead #}
<!-- Auto-generated from docs/templates/CONTRIBUTE.md.j2 - DO NOT EDIT DIRECTLY -->
<!-- Run 'just docs' to regenerate -->

# Contributing to {{ project_name }}

This guide explains how to develop, build, test, and release the vigOS development container image.

## Requirements

{{ requirements_table }}

**Ubuntu/Debian:**

```bash
{{ install_debian }}
```

**macOS (Homebrew):**

```bash
{{ install_macos }}
```

- For other Linux distributions, use your package manager (e.g., `dnf`, `yum`, `zypper`, `apk`) to install these dependencies.
- Run `./scripts/init.sh` to check dependencies and get OS-specific installation commands.
- Ensure Docker is installed if you plan to use it instead of Podman.

## Setup

Clone this repository and prepare it for container development:

```bash
git clone git@github.com:vig-os/devcontainer.git
cd devcontainer
just init           # Install dependencies and setup development environment
```

## Development Workflow

When contributing to this project, follow this workflow:

1. **Create an issue** to report a bug or request a feature
   - Use [GitHub Issues](https://github.com/vig-os/devcontainer/issues) to document the problem or feature request
   - This helps track work and provides context for reviewers

2. **Create a branch from `dev` branch**

   ```bash
   git checkout dev
   git pull origin dev
   git checkout -b feature/your-feature-name
   # or
   git checkout -b fix/your-bug-fix
   ```

3. **Work on the issue or feature**
   - Make your changes
   - Commit often and descriptively
   - Add tests
   - Build and test locally: `just build && just test`
   - Ensure your code follows the project's style and conventions

4. **Update documentation if necessary**
   - Update templates in `docs/templates/` (not the generated files directly)
   - Run `just docs` to regenerate documentation
   - Update the [CHANGELOG](CHANGELOG.md) with your changes in the `[Unreleased]` section
     - Add entries under appropriate categories (Added, Changed, Fixed, etc.)
     - Use clear, concise descriptions
     - Reference related [issues](https://github.com/vig-os/devcontainer/issues) and [PRs](https://github.com/vig-os/devcontainer/pulls) when applicable
   - Keep documentation in sync with code changes

5. **Verify tests pass**

   ```bash
   # Run all test suites (image, integration, utils, version-check, install script)
   just test

   # Or run individual test suites
   just test-image
   just test-integration
   just test-utils
   just test-version-check
   just test-sidecar
   ```

6. **Create a pull request**
   - Create a [pull request](https://github.com/vig-os/devcontainer/pulls) targeting the `dev` branch
   - Link the PR to the related [issue(s)](https://github.com/vig-os/devcontainer/issues)
   - Provide a clear description of your changes

7. **Accepted contributions will be merged into `dev` branch**
   - Maintainers will review your PR
   - Address any feedback or requested changes
   - Once approved, your changes will be merged into `dev`

## Just Recipes

```text
{{ just_help_output }}
```

## Release Workflow

When releasing a new version of the devcontainer image, follow these steps:

1. **Update documentation**
   - Ensure documentation templates are up to date
   - Run `just docs` to regenerate all documentation
   - Update [CHANGELOG.md](CHANGELOG.md):
     - Move all `[Unreleased]` entries to a new version section (e.g., `[1.0.0]`)
     - Add the release date in YYYY-MM-DD format
     - Update the version links at the bottom of the file
     - Clear the `[Unreleased]` section for future changes
   - Verify all documentation reflects the current state

2. **Run tests**

   ```bash
   # Run all test suites to ensure everything works
   just test
   ```

3. **Ensure clean git state**

   ```bash
   # Make sure you are on the dev branch
   git checkout dev
   git pull origin dev

   # Ensure no uncommitted changes
   git status
   # All changes should be committed before releasing
   ```

4. **Create and push the version tag to trigger the release workflow**

   Releases are published by the [GitHub Actions workflow](.github/workflows/release.yml) when a version tag (e.g. `v1.0.0`) is pushed.

   ```bash
   # Replace X.Y.Z with the semantic version (e.g. 1.0.0, 1.1.0, 2.0.0)
   # Version must follow Semantic Versioning: MAJOR.MINOR.PATCH
   git tag -a vX.Y.Z -m "Release X.Y.Z"
   git push origin vX.Y.Z
   ```

   The workflow will:
   - Build the image for the specified version (multi-arch: amd64, arm64)
   - Run image tests before push
   - Push to GHCR with `:latest` and `:X.Y.Z` tags
   - Create a multi-architecture manifest

   Ensure [CHANGELOG.md](CHANGELOG.md) and any version references are updated before tagging.

5. **Create pull request to merge into `main`**
   - After the version tag is pushed and the publish workflow completes, create a [pull request](https://github.com/vig-os/devcontainer/pulls) from `dev` to `main`
   - The PR should include:
     - Summary of changes in this release
     - Reference to the version tag created
     - Any important notes for users
   - Once merged, `main` will reflect the stable release

## Version Tagging

{{ project_name }} uses **Semantic Versioning** ([SemVer](https://semver.org/)) to manage both GHCR tags and git tags:

- **Development versions** (`dev`):
  - Only local, without time stamp or git reference
  - Meant for development and testing only
  - Use `just build` and `just test` to build and test

- **Stable versions** (e.g., `1.2.0`, `2.0.0`):
  - Follow Semantic Versioning format: `MAJOR.MINOR.PATCH` (e.g., `1.0.0`, `1.2.3`, `2.0.0`)
  - Pushes to GHCR with both `:latest` and `:version` tags
  - Creates git tag `v{version}` (e.g., `v1.2.0`)
  - Use `just push X.Y.Z` where X.Y.Z is the semantic version

This ensures that `:latest` always points to the latest stable release, and git tags provide traceability for all stable container versions.

## Multi-Architecture Support

{{ project_name }} supports both **AMD64** (x86_64) and **ARM64** (Apple Silicon) architectures:

- **Local builds** (`just build` and `just test`): Build and test for your native platform (ARM64 on macOS, AMD64 on Linux)
- **Releases** (GitHub Actions on version tags): The publish workflow builds and pushes multi-arch manifests (amd64, arm64) to GHCR
- **Pull from registry** (`just pull`): Pull the correct architecture for your platform from GHCR

This allows development on any supported platform and consistent multi-arch images for releases.

## Testing

{{ project_name }} relies on comprehensive tests to verify both container images and devcontainer functionality.
For detailed information about the testing strategy, test structure, and how to develop tests, see the [Testing Guide](TESTING.md).
