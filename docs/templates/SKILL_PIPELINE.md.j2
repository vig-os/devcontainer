<!-- Auto-generated from docs/templates/SKILL_PIPELINE.md.j2 - DO NOT EDIT DIRECTLY -->
<!-- Run 'just docs' to regenerate -->

# Agent Skill Pipeline

How the `/command` skills fit together, what each one does, and when to use them.

## Overview

Skills are markdown playbooks that live in `.cursor/skills/`. Each one defines a repeatable workflow the agent follows when invoked via `/skill-name`. They are grouped into phases that form two parallel pipelines: **interactive** (human-in-the-loop) and **autonomous** (worktree, no user prompts).

```
              ┌─────────────────────────────────────────────┐
              │          INCEPTION (bootstrap)              │
              │             inception_explore               │
              │             inception_scope                 │
              │             inception_architect             │
              │             inception_plan                  │
              └──────────────────────┬──────────────────────┘
                                     │
              ┌──────────────────────▼──────────────────────┐
              │             ISSUE MANAGEMENT                │
              │                issue_triage                 │
              │                issue_create                 │
              │                issue_claim                  │
              └──────────────────────┬──────────────────────┘
                                     │
               ┌────────────────────────────────────────────────────────────────────┐
               │                                                                    │
     INTERACTIVE (human-in-the-loop)                                       AUTONOMOUS (worktree)
               │                                                                    │
  ┌────────────▼─────────────┐                              ┌───────────────────────▼─────────────────────┐
  │  design_brainstorm       │                              │  /solve-and-pr <issue>                      │
  │  design_plan             │                              │  └─► just worktree-start                    │
  │  code_tdd / code_execute │                              │       └─► worktree_solve-and-pr             │
  │  code_verify             │                              │            ├─ worktree_brainstorm           │
  │  code_review             │─► handoff via `just wt-..` ─►│            ├─ worktree_plan                 │
  │  git_commit              │                              │            ├─ worktree_execute              │
  │  pr_create               │                              │            ├─ worktree_verify               │
  │  ci_check / ci_fix       │                              │            ├─ worktree_pr                   │
  │                          │                              │            └─ worktree_ci-check / ci-fix    │
  └─────────────▼────────────┘                              │                                             │
                |                                           │  worktree_ask  (escape hatch: post          │
                |                                           │                 question on issue)          │
                |                                           │                                             │
                |                                           └──────────────────────▼──────────────────────┘
                |                                                                  │
                └─────────────────────────────────▼────────────────────────────────┘
                                                  |
                                                  |
                             ┌────────────────────▼──────────────────────┐
                             │            RELEASE MANAGEMENT             │
              │             pr_create                     │
              │             pr_post-merge                 │
                             └───────────────────────────────────────────┘


```

## Phase Breakdown

{%- for group in skill_groups %}

### {{ group.heading }}
{% if group.intro %}
{{ group.intro }}
{% endif %}
| Skill | Trigger | What it does |
|-------|---------|-------------|
{% for s in group.skills -%}
| `{{ s.name }}` | `{{ s.trigger }}` | {{ s.description }} |
{% endfor %}
{%- endfor %}

## Artifacts & Outputs

Each phase produces concrete artifacts that feed into the next. This is the data flow through the pipeline.

### Inception → Issues

| Step | Output | Where it lives |
|------|--------|---------------|
| `inception_explore` | RFC document (Problem Statement, Impact, References) | `docs/rfcs/RFC-XXX-*.md` |
| `inception_scope` | RFC updated (Proposed Solution, Alternatives, Phasing); status → `proposed` | `docs/rfcs/RFC-XXX-*.md` |
| `inception_architect` | Design document (architecture, components, topology, tech stack) | `docs/designs/DES-XXX-*.md` |
| `inception_plan` | Parent epic + sub-issues + spike issues; milestone assignments; effort labels; RFC/Design updated with issue links | GitHub Issues |

### Issue Management → Branch

| Step | Output | Where it lives |
|------|--------|---------------|
| `issue_triage` | Triage matrix; labels, milestones, parent-issue links applied | `.github_data/triage-matrix.md` + GitHub |
| `issue_create` | New GitHub issue from template | GitHub |
| `issue_claim` | Issue assigned to you; linked branch created and checked out | GitHub + local git |

### Design → Plan (posted on the issue)

| Step | Output | Where it lives |
|------|--------|---------------|
| `design_brainstorm` | `## Design` comment (approved design) | GitHub issue comment |
| `design_plan` | `## Implementation Plan` comment (ordered tasks with acceptance criteria) | GitHub issue comment |

### Code → Commits

| Step | Output | Where it lives |
|------|--------|---------------|
| `code_tdd` | RED commit (`test: …`), GREEN commit (`feat: …`/`fix: …`), optional REFACTOR commit | Local git |
| `code_execute` | Code commits per batch; plan comment updated with checked-off tasks | Local git + GitHub issue comment |
| `code_debug` | Failing-test commit + fix commit | Local git |
| `code_verify` | Pass/fail verification report (tests, lint, precommit) | Terminal output |
| `code_review` | Structured review report (acceptance criteria checklist, issues by severity) | Terminal output (readonly subagent) |

### Git & PR → Pull Request

| Step | Output | Where it lives |
|------|--------|---------------|
| `git_commit` | Single commit following project conventions | Local git |
| `pr_create` | PR draft file + GitHub PR + CHANGELOG update if needed | `.github/pr-draft-*.md` + GitHub PR |
| `pr_post-merge` | Feature branch deleted; switched to base branch; draft file cleaned up | Local git |

### CI → Green Build

| Step | Output | Where it lives |
|------|--------|---------------|
| `ci_check` | CI status report | Terminal output |
| `ci_fix` | Fix commits pushed to remote | Local + remote git |

### Autonomous Pipeline (same artifacts, no human prompts)

> **Important:** `worktree_*` skills are **not** invoked directly in your editor session. They only work inside a worktree launched via `just worktree-start`, which sets up the isolated environment, tmux session, and `cursor-agent` process they depend on.

| Step | Output | Where it lives |
|------|--------|---------------|
| `worktree_brainstorm` | `## Design` comment | GitHub issue comment |
| `worktree_plan` | `## Implementation Plan` comment | GitHub issue comment |
| `worktree_execute` | Code commits; plan tasks checked off | Local git + GitHub issue comment |
| `worktree_verify` | Verification report; fix commits if needed | Terminal + local git |
| `worktree_pr` | GitHub PR + CHANGELOG update | GitHub PR |
| `worktree_ci-check` | CI polling result | Terminal output |
| `worktree_ci-fix` | `## CI Diagnosis` comment + fix commits pushed | GitHub issue comment + remote git |
| `worktree_ask` | `## Question` comment (escape hatch) | GitHub issue comment |
| `worktree_solve-and-pr` | `## Autonomous Run Complete` summary + all of the above | GitHub issue comment |

## State Detection (Autonomous Pipeline)

`worktree_solve-and-pr` determines where to resume by scanning issue comments:

| Comment heading found | Phase considered done | Next phase |
|---|---|---|
| *(none)* | — | `worktree_brainstorm` |
| `## Design` | Design | `worktree_plan` |
| `## Implementation Plan` | Planning | `worktree_execute` |

This makes the autonomous pipeline **idempotent** — re-running it picks up where it left off.

## Subagent Delegation

Skills can delegate mechanical sub-steps (CLI calls, template filling, comment posting) to lightweight subagents via the Task tool, keeping the primary model focused on reasoning. Delegation tiers are defined in `.cursor/rules/subagent-delegation.mdc`:

- **Lightweight** — CLI commands, file reading, template filling, comment posting
- **Standard** — code review, log analysis, structured verification
- **Main agent** — design, code generation, debugging, TDD loops

## Worktree Infrastructure (`justfile.worktree`)

The autonomous pipeline doesn't run inside your current editor session. It runs in an isolated **git worktree** managed by `just` recipes, with a `cursor-agent` process inside a `tmux` session. This is the runtime layer that makes `worktree_*` skills work.

### Lifecycle Recipes

| Recipe | What it does |
|--------|-------------|
| `just worktree-start <issue> "<prompt>"` | Creates a worktree, resolves (or creates) the linked branch, sets up the environment (`uv sync`, `pre-commit install`, `.env` copy), trusts the directory for `cursor-agent`, then launches a `tmux` session running `agent chat --yolo` with the given prompt. If the worktree already exists, it reuses it. |
| `just worktree-attach <issue>` | Attaches to the running `tmux` session so you can watch or intervene. |
| `just worktree-list` | Lists all worktrees with their branch, issue number, and tmux status (`[RUNNING]` / `[STOPPED]`). |
| `just worktree-stop <issue>` | Kills the tmux session, removes the worktree directory, and deletes the local branch. |
| `just worktree-clean` | Stops and removes all worktrees at once. Prunes stale git worktree refs. |

### What `worktree-start` Does Under the Hood

1. **Prerequisites** — checks for `tmux` and `cursor-agent` CLI.
2. **Authentication** — tries existing browser login, falls back to `CURSOR_API_KEY`, or prompts `agent login`.
3. **Branch resolution** — calls `gh issue develop --list` to find the linked branch. If none exists, it:
   - Fetches issue metadata, infers branch type from labels (`bugfix` vs `feature`).
   - Uses a lightweight agent call to derive a kebab-case summary from the issue title.
   - Determines the base branch (parent issue's branch, or `dev`).
   - Creates and links the branch via `gh issue develop`.
   - Assigns the issue to `@me`.
4. **Worktree setup** — `git worktree add`, then inside the worktree: `uv sync`, `pre-commit install`, copies `.env` from the main worktree.
5. **Trust** — adds the worktree path to `~/.cursor/cli-config.json` `trustedDirectories`.
6. **Launch** — starts `tmux new-session` running `agent chat --model <autonomous-model> --yolo "<prompt>"`.

The `--yolo` flag means the agent auto-approves all shell commands — appropriate because there's no human at this terminal.

### Model Selection

Agent models are read from `.cursor/agent-models.toml`. The worktree recipes use:
- **`autonomous` tier** for the main `agent chat` session (design, code, reasoning).
- **`lightweight` tier** for the one-shot branch-naming call.

## Typical Interactive Workflow

```
/issue-claim 42
/design-brainstorm          ← explore + propose + approve
/design-plan                ← break into tasks
/code-tdd                   ← implement (repeat per task)
/code-verify                ← run full verification
/code-review                ← pre-PR review
/git-commit                 ← commit (as needed throughout)
/pr-create                  ← open PR
/ci-check                   ← confirm CI passes
/pr-post-merge              ← cleanup after merge
```

## Typical Autonomous Workflow

### Option 1: From your editor

```
/solve-and-pr 42            ← launches worktree, returns immediately
# Agent runs in background: brainstorm → plan → execute → verify → pr → ci-check
# Progress posted as issue comments. You're the reviewer.
```

### Option 2: From the command line

```bash
just worktree-start 42 "/worktree-solve-and-pr"
# Same as above, but launched via just directly
# All progress posted as issue comments. No human interaction needed.

just worktree-attach 42     # watch or intervene
just worktree-stop 42       # tear down when done
```
