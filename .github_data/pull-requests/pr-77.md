---
type: pull_request
state: closed (merged)
branch: bugfix/72-minor-improvements-ci-cd â†’ dev
created: 2026-02-18T09:55:01Z
updated: 2026-02-18T10:06:12Z
author: c-vigo
author_url: https://github.com/c-vigo
url: https://github.com/vig-os/devcontainer/pull/77
comments: 0
labels: bug
assignees: c-vigo
milestone: none
projects: none
relationship: none
merged: 2026-02-18T10:02:20Z
synced: 2026-02-18T12:21:42.307Z
---

# [PR 77](https://github.com/vig-os/devcontainer/pull/77) ci: fix release validation and test action checkout refs

## Summary

Implements all four findings from issue #72 code review to improve CI/CD reliability:

- **High Priority:** Block release workflow if CI checks are still pending/in-progress
- **Medium Priority:** Fix test actions silently switching commits during release
- **Low Priority:** Fix install-just conditional and remove dead macOS code

## Changes

### 1. Release Validation (High Priority)
- In `release.yml`: Added check to reject releases when CI checks are in non-terminal states (PENDING, IN_PROGRESS, QUEUED, or null)
- Prevents releases proceeding while checks are still running

### 2. Test Action Checkout Pinning (Medium Priority)
- Added `ref` input parameter to both `test-image` and `test-integration` composite actions
- Both actions now accept `ref` input to pin Git checkout to specific commit
- In `release.yml`: Pass `finalize_sha` to both test actions to ensure tests run against the exact commit that was built
- Eliminates silent commit switching if release branch receives commits during finalization

### 3. Install-just Conditional (Low Priority)
- Added missing `if: inputs.install-just == 'true'` condition to install-just step in `setup-env`
- Now respects the input flag like all other optional tools (podman, node, devcontainer-cli, bats)

### 4. Dead Code Cleanup (Low Priority)
- Removed macOS `stat -f%z` fallback from `build-image` tar verification
- Added clarifying comment that action only runs on ubuntu-22.04
- Improves code clarity by removing misleading platform-specific logic

## Related Issue

Refs: #72


---
---

## Commits

### Commit 1: [120947c](https://github.com/vig-os/devcontainer/commit/120947c392de106077d831768783d0a465a6858a) by [c-vigo](https://github.com/c-vigo) on February 18, 2026 at 09:47 AM
ci: fix release validation and test action checkout refs, 35 files modified
